---
title: "Grad Proj"
author: "Huma Meer"
date: '2022-07-23'
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(censusapi)

```

```{r}
# Add key to .Renviron
Sys.setenv(CENSUS_KEY="2af9f600486ef6ad342ed1e8a978c0956a70a52c")
# Reload .Renviron
readRenviron("~/.Renviron")
# Check to see that the expected key is output in your R console
Sys.getenv("CENSUS_KEY")
```

```{r}

cbp <- getCensus( name = "cbp" ,
           vintage = 2020,
           key = Sys.getenv("CENSUS_KEY"),
           vars = c("NAME","GEO_ID","GEO_ID_F","LFO","LFO_LABEL","CD","CSA","GEOCOMP","NAICS2017","NAICS2017_F","NAICS2017_LABEL","EMP","EMP_F","EMP_N","EMP_N_F", "EMPSZES","EMPSZES_LABEL","ESTAB","ESTAB_F","INDGROUP", "INDLEVEL","PAYANN", "PAYANN_N", "YEAR"),
           region = "county:*",
           show_call = TRUE)
view(cbp)
```
Calculating the Average Annual Payroll Per Employeer by Industry for the DMV area only


cbp_dmv <- getCensus( name = "cbp" ,
           vintage = 2020,
           key = Sys.getenv("CENSUS_KEY"),
           vars = c("NAME","NAICS2017","NAICS2017_LABEL","PAYANN","EMP"),
          region = "state:11,24,51")
cbp_dmv
cbp_dmv <-as_tibble(cbp_dmv)

cbp_AP_dmv <- cbp_dmv %>% 
  select(NAICS2017_LABEL,PAYANN, EMP) %>% 
  group_by(NAICS2017_LABEL) %>% 
  mutate(annual_payroll_per_employee= PAYANN/EMP) %>% 
  arrange(desc(annual_payroll_per_employee)) %>% 
  select(NAICS2017_LABEL,annual_payroll_per_employee)

cbp_AP_dmv <- cbp_AP_dmv[!duplicated(cbp_AP_dmv), ]
view(cbp_AP_dmv)

---
title: "Grad Proj"
author: "Huma Meer"
date: '2022-07-23'
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(censusapi)
install.packages("ragg")
library(ragg)
```

```{r}
# Add key to .Renviron
Sys.setenv(CENSUS_KEY="2af9f600486ef6ad342ed1e8a978c0956a70a52c")
# Reload .Renviron
readRenviron("~/.Renviron")
# Check to see that the expected key is output in your R console
Sys.getenv("CENSUS_KEY")
```


Calculating the Average Annual Payroll Per Employeer by Industry for the DMV area only

```{r}
#for dmv 
cbp_dmv <- getCensus( name = "cbp" ,
           vintage = 2020,
           key = Sys.getenv("CENSUS_KEY"),
           vars = c("NAME","NAICS2017","NAICS2017_LABEL","PAYANN","EMP"),
          region = "state:11,24,51")
cbp_dmv
cbp_dmv <-as_tibble(cbp_dmv)

cbp_AP_dmv <- cbp_dmv %>% 
  select(NAICS2017_LABEL,PAYANN, EMP) %>% 
  group_by(NAICS2017_LABEL) %>% 
  mutate(annual_payroll_per_employee= PAYANN/EMP) %>% 
  arrange(desc(annual_payroll_per_employee)) %>% 
  select(NAICS2017_LABEL,annual_payroll_per_employee)

cbp_AP_dmv <- cbp_AP_dmv[!duplicated(cbp_AP_dmv), ]
view(cbp_AP_dmv)


```

Creating a plot
```{r}

data.frame(cbp_AP_dmv)%>% 
  slice_head(n=10) %>% 
  ggplot() +
  geom_col(aes(y =reorder(NAICS2017_LABEL, annual_payroll_per_employee), x = annual_payroll_per_employee))+
  theme_minimal()+
  theme(axis.title.y = element_blank())
  



```


```{r}

#for us
cbp_US <- getCensus( name = "cbp" ,
           vintage = 2020,
           key = Sys.getenv("CENSUS_KEY"),
           vars = c("NAME","NAICS2017","NAICS2017_LABEL","PAYANN","EMP"),
          region = "us")
view(cbp_US)
cbp_dmv <-as_tibble(cbp_US)

cbp_AP <- cbp_US %>% 
  select(NAICS2017_LABEL,PAYANN, EMP) %>% 
  group_by(NAICS2017_LABEL) %>% 
  mutate(annual_payroll_per_employee= PAYANN/EMP) %>% 
  arrange(desc(annual_payroll_per_employee)) %>% 
  select(NAICS2017_LABEL,annual_payroll_per_employee)

cbp_AP <- cbp_AP[!duplicated(cbp_AP), ]
view(cbp_AP)
  
```



```{r}

#for US
cbp_US <- getCensus( name = "cbp" ,
           vintage = 2020,
           key = Sys.getenv("CENSUS_KEY"),
           vars = c("NAME","NAICS2017","NAICS2017_LABEL","PAYANN","EMP"),
          region = "us")
view(cbp_US)
cbp_dmv <-as_tibble(cbp_US)

cbp_AP <- cbp_US %>% 
  select(NAICS2017_LABEL,PAYANN, EMP) %>% 
  group_by(NAICS2017_LABEL) %>% 
  mutate(annual_payroll_per_employee= PAYANN/EMP) %>% 
  arrange(desc(annual_payroll_per_employee)) %>% 
  select(NAICS2017_LABEL,annual_payroll_per_employee)

cbp_AP <- cbp_AP[!duplicated(cbp_AP), ]
view(cbp_AP)
  
```
#Plot for US
```{r}
data.frame(cbp_AP)%>% 
  slice_head(n=10) %>% 
  ggplot() +
  geom_col(aes(y =reorder(NAICS2017_LABEL, annual_payroll_per_employee), x = annual_payroll_per_employee))
```

